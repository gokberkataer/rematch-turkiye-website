<%- include('layout', { title: 'İletişim', content: `
<div class="container py-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="text-center mb-5">
                <h1 class="display-4 mb-4">İletişim</h1>
                <p class="lead text-muted">Bizimle iletişime geçin, size yardımcı olmaktan mutluluk duyarız.</p>
            </div>

            <div class="card shadow-lg mb-5">
                <div class="card-body p-5">
                    <div id="loginRequired" class="text-center d-none">
                        <p class="mb-4">Mesaj göndermek için lütfen giriş yapın.</p>
                        <a href="/login" class="btn btn-primary">Giriş Yap</a>
                    </div>
                    <form id="contactForm" class="d-none">
                        <div class="mb-4">
                            <label for="name" class="form-label">Adınız Soyadınız</label>
                            <input type="text" class="form-control" id="name" required>
                        </div>
                        <div class="mb-4">
                            <label for="email" class="form-label">E-posta Adresiniz</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-4">
                            <label for="subject" class="form-label">Konu</label>
                            <input type="text" class="form-control" id="subject" required>
                        </div>
                        <div class="mb-4">
                            <label for="message" class="form-label">Mesajınız</label>
                            <textarea class="form-control" id="message" rows="5" required></textarea>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg">Gönder</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card shadow-lg">
                <div class="card-body p-5">
                    <h2 class="card-title h3 mb-4">Diğer İletişim Kanalları</h2>
                    <div class="d-flex justify-content-center gap-4">
                        <a href="https://instagram.com/rematch_tr" target="_blank" class="btn btn-outline-primary">
                            <i class="fab fa-instagram me-2"></i>Instagram
                        </a>
                        <a href="mailto:rematchtr.iletisim@gmail.com" class="btn btn-outline-primary">
                            <i class="fas fa-envelope me-2"></i>E-posta
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Notification Overlay -->
<div class="notification-overlay" id="notificationOverlay">
    <div class="notification-popup" id="notificationPopup">
        <div class="notification-title" id="notificationTitle"></div>
        <div class="notification-message" id="notificationMessage"></div>
        <div class="notification-buttons">
            <button class="btn btn-primary" id="notificationButton">Tamam</button>
        </div>
    </div>
</div>

<script>
// Check authentication status
async function checkAuth() {
    try {
        const response = await fetch('/api/auth/me');
        if (response.ok) {
            const user = await response.json();
            document.getElementById('loginRequired').classList.add('d-none');
            document.getElementById('contactForm').classList.remove('d-none');
            // Pre-fill user information
            document.getElementById('name').value = user.name || '';
            document.getElementById('email').value = user.email || '';
        } else {
            document.getElementById('loginRequired').classList.remove('d-none');
            document.getElementById('contactForm').classList.add('d-none');
        }
    } catch (error) {
        console.error('Auth check error:', error);
        showNotification('Hata', 'Kimlik doğrulama hatası oluştu.', 'error');
    }
}

document.getElementById('contactForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        subject: document.getElementById('subject').value,
        message: document.getElementById('message').value
    };

    try {
        const response = await fetch('/api/contact', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        if (response.ok) {
            showNotification('Başarılı', 'Mesajınız başarıyla gönderildi. En kısa sürede size dönüş yapacağız.', 'success');
            document.getElementById('contactForm').reset();
        } else {
            const data = await response.json();
            showNotification('Hata', data.error || 'Mesajınız gönderilemedi. Lütfen tekrar deneyin.', 'error');
        }
    } catch (error) {
        console.error('Contact form error:', error);
        showNotification('Hata', 'Bir hata oluştu. Lütfen tekrar deneyin.', 'error');
    }
});

function showNotification(title, message, type = 'info') {
    const overlay = document.getElementById('notificationOverlay');
    const popup = document.getElementById('notificationPopup');
    const titleElement = document.getElementById('notificationTitle');
    const messageElement = document.getElementById('notificationMessage');
    const button = document.getElementById('notificationButton');

    titleElement.textContent = title;
    messageElement.textContent = message;
    popup.className = 'notification-popup ' + type;
    overlay.classList.add('show');

    button.onclick = () => {
        overlay.classList.remove('show');
    };
}

// Check auth status when page loads
document.addEventListener('DOMContentLoaded', checkAuth);
</script>
`}) %> 